<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>点击就行</title>
        <style>
            canvas{
                position: absolute;
                top:1px;
                left:1px;
                border: red solid 1px;
                width: 70%;
                height: auto;
            }
            #yuantu{
                position: absolute;
                top:1px;
                left:1px;
                z-index: -2;
                width: 1%;
            }
            #xuanse{
                position:relative; 
				left: 5px; 
				top: 5px; 
				background: #FC6; 
				border:1px solid #F90; 
            }
            #placeholder{
                border: green solid 3px;
            }
        </style>
    </head>
    <body>
            <meta name="viewport" content="width=70%, initial-scale=1.0">
        <p>
            <canvas id="canvas" width="350" height="490" onload="huayuantu()">你的辣鸡浏览器并不支持canvas</canvas>
            <img id="yuantu" src="women.jpg" width="350" height="490" />
        </p>
        <p>选择填充的树皮，点击区域作画</p>
        <div id="xuanse">
        <div id="dangqian">
            <img id="placeholder" src="#" width="35" height="49" alt="xianzai">
            <button id="saveImageBtn">分享</button>
        </div>
                <div>
                    <img src="树皮纹理-02.png" width="35" height="49" alt="" onclick="huan(this)" onload="huayuantu()"/>
                    <img src="树皮纹理-03-2.png" width="35" height="49" alt="" onclick="huan(this)"/> 
                    <img src="树皮纹理-04.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-05-2.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-06-2.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-07.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-08.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-09.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-10.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-11.png" width="35" height="49" alt="" onclick="huan(this)"/>
                </div>
                <div>
                    <img src="树皮纹理-12.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-13.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-14.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-15.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-16.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-17.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-18.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-19.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-20.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-21.png" width="35" height="49" alt="" onclick="huan(this)"/>
                </div>
                <div>
                    <img src="树皮纹理-22.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-23.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-24.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-25.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-26.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-27.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-28.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-29.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-30.png" width="35" height="49" alt="" onclick="huan(this)"/>
                    <img src="树皮纹理-32.png" width="35" height="49" alt="" onclick="huan(this)"/>
                </div>
        </div>
        <script type="text/javascript">
        var xiu = [115,272,132,258,120,235,121,231,110,217,100,199,93,212,86,231,88,247,96,264,105,277];
        var xiuzi = [235,234,243,227,248,221,255,211,259,216,262,223,265,232,268,243,267,251,264,260,260,270,254,279,250,285,246,291,239,282,233,273,228,266,225,263,231,256,240,245,241,240,235,241];
        var kouzi = [117,221,109,211,101,195,108,182,113,173,120,165,124,159,126,175,128,184,136,185,143,184,136,194,139,204,151,221,166,238,168,257,180,270,195,274,204,272,204,328,199,370,173,369,154,366,133,363,111,357,107,337,109,303,114,289,124,281,136,269,142,264,135,257,128,245,124,236,124,221];
        var yifu = [232,168,238,179,244,187,248,196,253,205,248,212,244,220,236,228,231,223,231,233,232,242,232,248,225,256,222,261,214,266,222,278,229,287,236,296,242,303,241,322,240,339,238,348,238,361,228,363,218,366,204,368,203,358,206,335,206,317,206,298,206,272,210,263,211,243,211,231,218,220,223,210,227,200,223,190,219,186,229,189];
        var weijin = [167,239,167,225,168,210,169,196,170,185,171,174,172,168,180,170,187,170,196,171,204,170,208,170,208,185,208,201,208,215,208,235,208,245,208,256,206,267,201,272,193,272,182,269,174,262,169,256];
        var zuoyilin = [127,155,126,166,130,182,138,181,146,180,151,178,138,194,145,207,152,219,164,231,165,214,166,198,167,186,160,169,149,165,138,161];
        var youyilin = [211,168,210,182,211,192,210,201,211,212,211,221,211,225,217,214,221,204,224,197,220,192,215,184,221,184,226,186,227,175,229,166,228,161,224,158];
        var zuoxiu = [105,282,115,277,123,271,129,264,134,259,138,264,128,274,119,282,110,288];
        var youxiu = [218,268,222,265,229,275,234,282,242,291,245,297,242,300,236,294,230,286,224,277];
        var bozi = [123,144,128,136,131,127,140,131,149,133,161,135,170,138,182,139,194,140,202,140,211,139,218,132,223,138,222,144,213,151,223,151,223,155,219,160,212,164,201,167,189,168,175,166,160,163,149,160,137,157,127,151];
        var tou = [112,111,115,99,112,92,115,87,116,75,119,64,125,52,132,46,140,41,147,38,155,35,165,33,174,33,183,35,192,38,199,42,206,49,212,57,215,66,218,77,220,84,223,89,223,96,235,86,236,70,232,59,224,47,218,39,206,32,194,26,178,24,163,25,148,30,135,35,123,45,115,56,109,67,104,77,103,90,104,101];
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var x0,y0;
        var x,y;
        var canvasImage = new Image();
        var drawimage = function(yizu) {
           ctx.save();
            ctx.beginPath();
            ctx.moveTo(yizu[0],yizu[1]);
		for(var i = 1;i < yizu.length;i+=2){
			x0 = yizu[i-1];
			y0 = yizu[i];
			ctx.lineTo(x0,y0);
		}
		ctx.lineTo(yizu[0],yizu[1]);
            ctx.closePath();
          ctx.clip();
          ctx.drawImage(canvasImage, 0, 0,350,490);
         ctx.restore();
        };
        function huan(tu){
            var wl = tu.getAttribute("src");
            document.getElementById("placeholder").src = wl;
            canvasImage.src=wl;
        };
        function ispointin(shuzu){
            ctx.beginPath();
            ctx.moveTo(shuzu[0],shuzu[1]);
            for(var i = 1;i<shuzu.length;i+=2){
                x0=shuzu[i-1];
                y0=shuzu[i];
                ctx.lineTo(x0,y0);
            }
            ctx.lineTo(shuzu[0],shuzu[1]);
            ctx.closePath();
            return ctx.isPointInPath(x,y);
            
        };
        canvas.onclick=function(e){
            e=e||event;
            x=e.clientX-canvas.offsetLeft;
            y=e.clientY-canvas.offsetTop;
            if(ispointin(xiu)){
                drawimage(xiu);
            }
            if(ispointin(xiuzi)){
                drawimage(xiuzi);
            }
            if(ispointin(kouzi)){
                drawimage(kouzi);
            }
            if(ispointin(yifu)){
                drawimage(yifu);
            }
            if(ispointin(weijin)){
                drawimage(weijin);
            }
            if(ispointin(youxiu)){
                drawimage(youxiu);
            }
            if(ispointin(zuoyilin)){
                drawimage(zuoyilin);
            }
            if(ispointin(youyilin)){
                drawimage(youyilin);
            }
            if(ispointin(zuoxiu)){
                drawimage(zuoxiu);
            }
            
            if(ispointin(bozi)){
                drawimage(bozi);
            }
            if(ispointin(tou)){
                drawimage(tou);
            }
        };
        function huayuantu(){
            var img=document.createElement("img");
            img.src="women.jpg"
            ctx.drawImage(img,0,0);
        }
        function saveImageInfo(){
            drawqrcode();
            /*var image = canvas.toDataURL("image/png");  
            var w=window.open('about:blank','image from canvas');  
            w.document.write("<img src='"+image+"' alt='from canvas'/>");
            w.document.write("<p>长按后保存分享至朋友圈<P>")  */
        }
        function bindButtonEvent(element, type, handler)  
            {  
                   if(element.addEventListener) {  
                      element.addEventListener(type, handler, false);  
                   } else {  
                      element.attachEvent('on'+type, handler);  
                   }  
            }
        function drawqrcode(){
            var qrcode = document.createElement("img");
            ctx.save();
            qrcode.src ="qrco.jpg";
            ctx.drawImage(qrcode,0,0,100,100);
            ctx.restore();
        }
        var saveButton = document.getElementById("saveImageBtn");  
        bindButtonEvent(saveButton, "click", saveImageInfo); 
        

        </script>
    </body>
</html>